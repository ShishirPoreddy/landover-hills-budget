
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Landover Hills Budget Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .chart-wrapper {
      min-height: 100vh;
    }
    .chart-wrapper canvas {
      width: 100% !important;
      height: 90% !important;
    }
  </style>
</head>
<body class="bg-gray-100 p-0 m-0">
  <h1 class="text-3xl font-bold p-6">Landover Hills Budget Dashboard</h1>

  <div class="p-6 flex flex-col gap-12">
    <!-- Filters -->
    <div class="flex flex-wrap items-center gap-4">
      <label for="fiscalYear" class="text-lg font-medium">Fiscal Year</label>
      <select id="fiscalYear" class="border p-2 rounded"></select>

      <label for="category" class="text-lg font-medium">Category</label>
      <select id="category" class="border p-2 rounded">
        <option value="">All</option>
        <option value="ENFORCEMENT FEES">ENFORCEMENT FEES</option>
        <option value="GRANTS">GRANTS</option>
        <option value="LICENSE FEES">LICENSE FEES</option>
        <option value="MISC. REVENUES">MISC. REVENUES</option>
        <option value="POLICE GRANTS">POLICE GRANTS</option>
        <option value="TAXES">TAXES</option>
        <option value="TRASH REMOVAL">TRASH REMOVAL</option>
        <option value="ADMINISTRATION">ADMINISTRATION</option>
        <option value="POLICE DEPARTMENT">POLICE DEPARTMENT</option>
      </select>

      <button id="applyFilters" class="bg-blue-600 text-white px-4 py-2 rounded">
        Apply Filters
      </button>
    </div>

    <div class="chart-wrapper bg-white rounded shadow p-6">
      <h2 class="text-2xl font-semibold mb-4">Total Budget by Category</h2>
      <canvas id="categoryChart"></canvas>
    </div>

    <div class="chart-wrapper bg-white rounded shadow p-6">
      <h2 class="text-2xl font-semibold mb-4">Breakdown</h2>
      <canvas id="amountByCategoryChart"></canvas>
    </div>

    <div class="chart-wrapper bg-white rounded shadow p-6">
      <h2 class="text-2xl font-semibold mb-4">Budget by Category Over Time</h2>
      <canvas id="areaChart"></canvas>
    </div>
  </div>

  <script>
    const API_KEY  = 'AIzaSyAFMUIi5DH5XfgJKP-lNnx0vZNSZvqLFMo';
    const SHEET_ID = '1u9syd7w3RRqsfEp14s0Yf5pUrJED-SImtAmWKWSN_ew';
    const RANGE    = 'Sheet1!A:E';

    let categoryChart, amountByCategoryChart, areaChart;
    let data = [];

    async function fetchData() {
      const url      = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`;
      const response = await fetch(url);
      const json     = await response.json();
      data = json.values.slice(1).map(row => ({
        category:      row[0],
        accountNumber: row[1],
        lineItem:      row[2],
        amount:        parseFloat(row[3]) || 0,
        fiscalYear:    row[4]
      })).filter(d => !isNaN(d.amount));
    }

    function populateFiscalYears() {
      const fySelect = document.getElementById('fiscalYear');
      const years = Array.from(new Set(data.map(d => d.fiscalYear))).sort();
      fySelect.innerHTML =
        '<option value="">All</option>' +
        years.map(y => `<option value="${y}">${y}</option>`).join('');
    }

    function updateCharts() {
      const fiscalYear = document.getElementById('fiscalYear').value;
      const category   = document.getElementById('category').value;

      let filtered = data;
      if (fiscalYear) filtered = filtered.filter(d => d.fiscalYear === fiscalYear);
      if (category)   filtered = filtered.filter(d => d.category   === category);

      const totals = {};
      filtered.forEach(d => {
        totals[d.category] = (totals[d.category] || 0) + d.amount;
      });
      const catLabels  = Object.keys(totals);
      const catAmounts = Object.values(totals);
      if (categoryChart) categoryChart.destroy();
      categoryChart = new Chart(
        document.getElementById('categoryChart'), {
          type: 'bar',
          data: {
            labels: catLabels,
            datasets: [{
              label: 'Total Amount ($)',
              data: catAmounts,
              backgroundColor: 'rgba(75, 192, 192, 0.2)',
              borderColor:     'rgba(75, 192, 192, 1)',
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              x: {
                ticks: {
                  autoSkip: false,
                  maxRotation: 45,
                  minRotation: 45,
                  font: { size: 16 }
                }
              },
              y: {
                beginAtZero: true,
                ticks: { font: { size: 14 } }
              }
            },
            plugins: {
              legend: { labels: { font: { size: 14 } } }
            }
          }
        }
      );

      const breakdownLabels = [];
      const breakdownData   = [];
      let pieTitle = '';
      if (category) {
        const byItem = {};
        filtered.forEach(d => {
          byItem[d.lineItem] = (byItem[d.lineItem] || 0) + d.amount;
        });
        pieTitle = `Breakdown for ${category}`;
        Object.entries(byItem).forEach(([itm, amt]) => {
          breakdownLabels.push(itm);
          breakdownData.push(amt);
        });
      } else {
        const topCats = Object.entries(totals)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 5);
        pieTitle = 'Top 5 Categories by Budget';
        topCats.forEach(([ct, amt]) => {
          breakdownLabels.push(ct);
          breakdownData.push(amt);
        });
      }
      const pieColors = breakdownLabels.map((_, i) =>
        `hsl(${(i * 360 / breakdownLabels.length)},70%,60%)`
      );
      if (amountByCategoryChart) amountByCategoryChart.destroy();
      amountByCategoryChart = new Chart(
        document.getElementById('amountByCategoryChart'), {
          type: 'pie',
          data: {
            labels: breakdownLabels,
            datasets: [{
              data: breakdownData,
              backgroundColor: pieColors,
              hoverOffset: 8
            }]
          },
          options: {
            plugins: {
              title: {
                display: true,
                text: pieTitle,
                font: { size: 18 }
              },
              legend: {
                position: 'right',
                labels: { font: { size: 14 }, boxWidth: 12 }
              },
              tooltip: {
                callbacks: {
                  label: ctx => `${ctx.label}: $${ctx.raw.toLocaleString()}`
                }
              }
            },
            animation: { animateScale: true }
          }
        }
      );

      const years = Array.from(new Set(filtered.map(d => d.fiscalYear))).sort();
      const byYear = {};
      filtered.forEach(d => {
        byYear[d.fiscalYear] = byYear[d.fiscalYear] || {};
        byYear[d.fiscalYear][d.category] = (byYear[d.fiscalYear][d.category] || 0) + d.amount;
      });
      const cats = Array.from(new Set(filtered.map(d => d.category)));
      const palette = cats.map((_, i) => {
        const hue = Math.round(i * 360 / cats.length);
        return { bg: `hsla(${hue},70%,60%,0.5)`, br: `hsl(${hue},70%,50%)` };
      });
      const areaDatasets = cats.map((ct, i) => ({
        label: ct,
        data: years.map(y => byYear[y]?.[ct] || 0),
        fill: true,
        backgroundColor: palette[i].bg,
        borderColor:     palette[i].br,
        tension: 0.3
      }));
      if (areaChart) areaChart.destroy();
      areaChart = new Chart(
        document.getElementById('areaChart'), {
          type: 'line',
          data: {
            labels: years,
            datasets: areaDatasets
          },
          options: {
            scales: {
              x: {
                title: { display: true, text: 'Fiscal Year', font: { size: 16 } }
              },
              y: {
                stacked: true,
                beginAtZero: true,
                title: { display: true, text: 'Amount ($)', font: { size: 16 } }
              }
            },
            plugins: {
              title: {
                display: true,
                text: 'Budget by Category Over Time',
                font: { size: 18 }
              },
              tooltip: {
                intersect: false,
                mode: 'index',
                callbacks: {
                  label: ctx => `${ctx.dataset.label}: $${ctx.parsed.y.toLocaleString()}`
                }
              }
            },
            interaction: { intersect: false, mode: 'index' }
          }
        }
      );
    }

    fetchData().then(() => {
      populateFiscalYears();
      updateCharts();
    });
    document.getElementById('applyFilters').addEventListener('click', updateCharts);
  </script>
</body>
</html>
```

